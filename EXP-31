#include <stdio.h>
#include <stdint.h>
#include <string.h>

#define BLOCK_SIZE 16   // 16 bytes = 128 bits

void block_cipher(uint8_t *in, uint8_t *key, uint8_t *out) {
    for (int i = 0; i < BLOCK_SIZE; i++)
        out[i] = in[i] ^ key[i];
}

void left_shift(uint8_t *in, uint8_t *out) {
    uint8_t carry = 0, next_carry;
    for (int i = BLOCK_SIZE - 1; i >= 0; i--) {
        next_carry = (in[i] & 0x80) ? 1 : 0;
        out[i] = (in[i] << 1) | carry;
        carry = next_carry;
    }
}

void generate_subkeys(uint8_t *key, uint8_t *K1, uint8_t *K2) {
    uint8_t zero_block[BLOCK_SIZE] = {0};
    uint8_t L[BLOCK_SIZE];
    uint8_t Rb = 0x87;   // 128-bit block constant

    block_cipher(zero_block, key, L);

    left_shift(L, K1);
    if (L[0] & 0x80)
        K1[BLOCK_SIZE - 1] ^= Rb;

    left_shift(K1, K2);
    if (K1[0] & 0x80)
        K2[BLOCK_SIZE - 1] ^= Rb;
}

void print_block(const char *label, uint8_t *b) {
    printf("%s: ", label);
    for (int i = 0; i < BLOCK_SIZE; i++)
        printf("%02X ", b[i]);
    printf("\n");
}

int main() {
    uint8_t key[BLOCK_SIZE];
    memset(key, 0x0F, BLOCK_SIZE);

    uint8_t K1[BLOCK_SIZE], K2[BLOCK_SIZE];

    generate_subkeys(key, K1, K2);

    print_block("Subkey K1", K1);
    print_block("Subkey K2", K2);

    return 0;
}
