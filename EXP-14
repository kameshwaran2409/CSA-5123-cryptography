#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include <time.h>

int mod26(int x)
{
    return (x % 26 + 26) % 26;
}

int main()
{
    char plaintext[100], ciphertext[100], decrypted[100];
    int key[100];
    int i;

    srand(time(NULL));

    printf("Enter Plain Text: ");
    gets(plaintext);

    /* Generate random key */
    for(i = 0; plaintext[i] != '\0'; i++)
    {
        if(isalpha(plaintext[i]))
            key[i] = rand() % 26;
        else
            key[i] = -1;
    }

    /* Encryption */
    for(i = 0; plaintext[i] != '\0'; i++)
    {
        if(isalpha(plaintext[i]))
        {
            int p = toupper(plaintext[i]) - 'A';
            int c = mod26(p + key[i]);
            ciphertext[i] = c + 'A';
        }
        else
        {
            ciphertext[i] = plaintext[i];
        }
    }

    ciphertext[i] = '\0';

    /* Decryption */
    for(i = 0; ciphertext[i] != '\0'; i++)
    {
        if(isalpha(ciphertext[i]))
        {
            int c = ciphertext[i] - 'A';
            int p = mod26(c - key[i]);
            decrypted[i] = p + 'A';
        }
        else
        {
            decrypted[i] = ciphertext[i];
        }
    }

    decrypted[i] = '\0';

    printf("\nGenerated Key (0â€“25):\n");
    for(i = 0; plaintext[i] != '\0'; i++)
        if(key[i] != -1)
            printf("%d ", key[i]);

    printf("\n\nCipher Text:\n%s", ciphertext);
    printf("\n\nDecrypted Text:\n%s", decrypted);

    return 0;
}
