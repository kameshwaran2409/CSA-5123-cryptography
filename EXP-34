#include <stdio.h>
#include <stdint.h>
#include <string.h>

#define BLOCK_SIZE 8

/* Simple XOR block cipher (educational) */
void encrypt_block(uint8_t *in, uint8_t *key, uint8_t *out) {
    for (int i = 0; i < BLOCK_SIZE; i++)
        out[i] = in[i] ^ key[i];
}

/* Padding: 1 followed by 0s */
int pad(uint8_t *data, int len) {
    int pad_len = BLOCK_SIZE - (len % BLOCK_SIZE);
    data[len] = 0x80;               // 10000000
    for (int i = len + 1; i < len + pad_len; i++)
        data[i] = 0x00;
    return len + pad_len;
}

/* ECB Mode */
void ECB(uint8_t *data, int len, uint8_t *key) {
    uint8_t out[BLOCK_SIZE];
    for (int i = 0; i < len; i += BLOCK_SIZE) {
        encrypt_block(&data[i], key, out);
        memcpy(&data[i], out, BLOCK_SIZE);
    }
}

/* CBC Mode */
void CBC(uint8_t *data, int len, uint8_t *key, uint8_t *iv) {
    uint8_t temp[BLOCK_SIZE], out[BLOCK_SIZE];
    for (int i = 0; i < len; i += BLOCK_SIZE) {
        for (int j = 0; j < BLOCK_SIZE; j++)
            temp[j] = data[i + j] ^ iv[j];

        encrypt_block(temp, key, out);
        memcpy(iv, out, BLOCK_SIZE);
        memcpy(&data[i], out, BLOCK_SIZE);
    }
}

/* CFB Mode */
void CFB(uint8_t *data, int len, uint8_t *key, uint8_t *iv) {
    uint8_t out[BLOCK_SIZE];
    for (int i = 0; i < len; i += BLOCK_SIZE) {
        encrypt_block(iv, key, out);
        for (int j = 0; j < BLOCK_SIZE; j++) {
            data[i + j] ^= out[j];
            iv[j] = data[i + j];
        }
    }
}

void print_data(char *label, uint8_t *data, int len) {
    printf("%s: ", label);
    for (int i = 0; i < len; i++)
        printf("%02X ", data[i]);
    printf("\n");
}

int main() {
    uint8_t key[BLOCK_SIZE] = {1,2,3,4,5,6,7,8};
    uint8_t iv[BLOCK_SIZE]  = {0};

    uint8_t message[64] = "HELLO CRYPTO";
    int len = strlen((char *)message);

    len = pad(message, len);

    print_data("Original (Padded)", message, len);

    uint8_t ecb[64], cbc[64], cfb[64];
    memcpy(ecb, message, len);
    memcpy(cbc, message, len);
    memcpy(cfb, message, len);

    ECB(ecb, len, key);
    print_data("ECB Ciphertext", ecb, len);

    CBC(cbc, len, key, iv);
    print_data("CBC Ciphertext", cbc, len);

    memset(iv, 0, BLOCK_SIZE);
    CFB(cfb, len, key, iv);
    print_data("CFB Ciphertext", cfb, len);

    return 0;
}
