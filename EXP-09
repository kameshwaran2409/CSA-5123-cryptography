#include <stdio.h>
#include <string.h>
#include <ctype.h>

char matrix[5][5];

void generateMatrix(char key[])
{
    int used[26] = {0};
    int i, j, k = 0;
    char temp[25];

    for(i = 0; key[i] != '\0'; i++)
    {
        char ch = toupper(key[i]);
        if(ch == 'J') ch = 'I';

        if(isalpha(ch) && !used[ch - 'A'])
        {
            temp[k++] = ch;
            used[ch - 'A'] = 1;
        }
    }

    for(i = 0; i < 26; i++)
    {
        if(i + 'A' == 'J') continue;
        if(!used[i])
            temp[k++] = i + 'A';
    }

    k = 0;
    for(i = 0; i < 5; i++)
        for(j = 0; j < 5; j++)
            matrix[i][j] = temp[k++];
}

void findPos(char ch, int *row, int *col)
{
    int i, j;
    if(ch == 'J') ch = 'I';

    for(i = 0; i < 5; i++)
        for(j = 0; j < 5; j++)
            if(matrix[i][j] == ch)
            {
                *row = i;
                *col = j;
                return;
            }
}

void decrypt(char cipher[])
{
    int i;
    for(i = 0; cipher[i] != '\0'; i += 2)
    {
        int r1, c1, r2, c2;
        findPos(cipher[i], &r1, &c1);
        findPos(cipher[i+1], &r2, &c2);

        if(r1 == r2)
        {
            printf("%c%c",
                   matrix[r1][(c1 + 4) % 5],
                   matrix[r2][(c2 + 4) % 5]);
        }
        else if(c1 == c2)
        {
            printf("%c%c",
                   matrix[(r1 + 4) % 5][c1],
                   matrix[(r2 + 4) % 5][c2]);
        }
        else
        {
            printf("%c%c",
                   matrix[r1][c2],
                   matrix[r2][c1]);
        }
    }
}

int main()
{
    char key[50], cipher[200];

    printf("Enter Keyword: ");
    gets(key);

    printf("Enter Cipher Text: ");
    gets(cipher);

    generateMatrix(key);

    printf("\nDecrypted Message:\n");
    decrypt(cipher);

    return 0;
}
